<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Announcements - Rajasthan Digital Education</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .announcement-card { border-left: 4px solid #007bff; }
        .urgent-card { border-left: 4px solid #dc3545; }
        .event-card { border-left: 4px solid #28a745; }
    </style>
</head>
<body>
    <nav class="navbar navbar-dark bg-primary">
        <div class="container">
            <a class="navbar-brand" href="index.html">
                <i class="fas fa-bullhorn"></i> Official Announcements
            </a>
            <a href="index.html" class="btn btn-light">Back to Home</a>
        </div>
    </nav>

    <div class="container mt-4">
        <!-- Create Announcement (Teachers/Admin Only) -->
        <div class="card mb-4" id="createAnnouncementCard" style="display: none;">
            <div class="card-header bg-success text-white">
                <h5><i class="fas fa-plus-circle"></i> Create New Announcement</h5>
            </div>
            <div class="card-body">
                <form id="announcementForm">
                    <div class="row">
                        <div class="col-md-6">
                            <label class="form-label">Title</label>
                            <input type="text" class="form-control" id="announcementTitle" placeholder="Announcement title" required>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">Type</label>
                            <select class="form-control" id="announcementType" required>
                                <option value="general">General</option>
                                <option value="urgent">Urgent</option>
                                <option value="event">Event</option>
                            </select>
                        </div>
                        <div class="col-md-3">
                            <label class="form-label">College</label>
                            <input type="text" class="form-control" id="collegeName" placeholder="College name" required>
                        </div>
                    </div>
                    <div class="mb-3 mt-3">
                        <label class="form-label">Description</label>
                        <textarea class="form-control" id="announcementDescription" rows="4" placeholder="Announcement details" required></textarea>
                    </div>
                    <div class="row">
                        <div class="col-md-4">
                            <label class="form-label">Event Date (if applicable)</label>
                            <input type="date" class="form-control" id="eventDate">
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Registration Required?</label>
                            <select class="form-control" id="registrationRequired">
                                <option value="no">No</option>
                                <option value="yes">Yes</option>
                            </select>
                        </div>
                        <div class="col-md-4">
                            <label class="form-label">Contact Email</label>
                            <input type="email" class="form-control" id="contactEmail" placeholder="Contact email">
                        </div>
                    </div>
                    <button type="submit" class="btn btn-success mt-3">
                        <i class="fas fa-paper-plane"></i> Post Announcement
                    </button>
                </form>
            </div>
        </div>

        <!-- Announcements List -->
        <div class="row">
            <div class="col-md-8">
                <h4>Latest Announcements</h4>
                <div id="announcementsList">
                    <!-- Sample announcements will be loaded here -->
                </div>
            </div>
            <div class="col-md-4">
                <div class="card">
                    <div class="card-header bg-info text-white">
                        <h6><i class="fas fa-filter"></i> Filter Announcements</h6>
                    </div>
                    <div class="card-body">
                        <div class="mb-3">
                            <label class="form-label">Type</label>
                            <select class="form-control" id="filterType" onchange="filterAnnouncements()">
                                <option value="">All Types</option>
                                <option value="general">General</option>
                                <option value="urgent">Urgent</option>
                                <option value="event">Event</option>
                            </select>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">College</label>
                            <select class="form-control" id="filterCollege" onchange="filterAnnouncements()">
                                <option value="">All Colleges</option>
                                <option value="Government College Jaipur">Government College Jaipur</option>
                                <option value="Maharana Pratap College Udaipur">Maharana Pratap College Udaipur</option>
                                <option value="Agriculture College Bikaner">Agriculture College Bikaner</option>
                            </select>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Registration Modal -->
    <div class="modal fade" id="registrationModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header bg-primary text-white">
                    <h5 class="modal-title">Event Registration</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="eventRegistrationForm">
                        <div class="mb-3">
                            <label class="form-label">Student Name</label>
                            <input type="text" class="form-control" id="studentName" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Roll Number</label>
                            <input type="text" class="form-control" id="rollNumber" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">College</label>
                            <input type="text" class="form-control" id="studentCollege" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Email</label>
                            <input type="email" class="form-control" id="studentEmail" required>
                        </div>
                        <div class="mb-3">
                            <label class="form-label">Phone</label>
                            <input type="tel" class="form-control" id="studentPhone" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Register for Event</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        let announcements = [
            {
                id: 1,
                title: "Annual Tech Fest 2024",
                type: "event",
                college: "Government College Jaipur",
                description: "Join us for the biggest tech fest of the year! Coding competitions, robotics, AI workshops, and much more.",
                eventDate: "2024-03-15",
                registrationRequired: "yes",
                contactEmail: "techfest@gcjaipur.edu.in",
                postedBy: "Dr. Sharma",
                postedDate: "2024-01-15"
            },
            {
                id: 2,
                title: "Semester Exam Schedule Released",
                type: "urgent",
                college: "Maharana Pratap College Udaipur",
                description: "Final semester examinations will begin from March 1st, 2024. Please check the detailed schedule on college website.",
                eventDate: "2024-03-01",
                registrationRequired: "no",
                contactEmail: "exams@mpcudaipur.edu.in",
                postedBy: "Exam Controller",
                postedDate: "2024-01-10"
            },
            {
                id: 3,
                title: "Agriculture Workshop on Modern Farming",
                type: "event",
                college: "Agriculture College Bikaner",
                description: "Learn about modern farming techniques, organic farming, and sustainable agriculture practices.",
                eventDate: "2024-02-20",
                registrationRequired: "yes",
                contactEmail: "workshop@acbikaner.edu.in",
                postedBy: "Prof. Gupta",
                postedDate: "2024-01-12"
            },
            {
                id: 4,
                title: "Library Hours Extended",
                type: "general",
                college: "Government College Jaipur",
                description: "Library will now remain open till 10 PM on weekdays and 8 PM on weekends for better student convenience.",
                eventDate: null,
                registrationRequired: "no",
                contactEmail: "library@gcjaipur.edu.in",
                postedBy: "Librarian",
                postedDate: "2024-01-08"
            }
        ];

        let currentUser = JSON.parse(localStorage.getItem('currentUser') || '{}');
        let selectedAnnouncementId = null;

        // Show create announcement form for teachers
        if (currentUser.userType === 'teacher') {
            document.getElementById('createAnnouncementCard').style.display = 'block';
        }

        // Load announcements on page load
        loadAnnouncements();

        document.getElementById('announcementForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const newAnnouncement = {
                id: Date.now(),
                title: document.getElementById('announcementTitle').value,
                type: document.getElementById('announcementType').value,
                college: document.getElementById('collegeName').value,
                description: document.getElementById('announcementDescription').value,
                eventDate: document.getElementById('eventDate').value,
                registrationRequired: document.getElementById('registrationRequired').value,
                contactEmail: document.getElementById('contactEmail').value,
                postedBy: currentUser.email || 'Faculty',
                postedDate: new Date().toISOString().split('T')[0]
            };

            announcements.unshift(newAnnouncement);
            localStorage.setItem('announcements', JSON.stringify(announcements));
            
            loadAnnouncements();
            this.reset();
            alert('Announcement posted successfully!');
        });

        function loadAnnouncements() {
            const savedAnnouncements = localStorage.getItem('announcements');
            if (savedAnnouncements) {
                announcements = JSON.parse(savedAnnouncements);
            }

            displayAnnouncements(announcements);
        }

        function displayAnnouncements(announcementsToShow) {
            const container = document.getElementById('announcementsList');
            
            if (announcementsToShow.length === 0) {
                container.innerHTML = '<div class="text-center text-muted py-4"><h5>No announcements found</h5></div>';
                return;
            }

            container.innerHTML = announcementsToShow.map(announcement => `
                <div class="card mb-3 ${getCardClass(announcement.type)}">
                    <div class="card-body">
                        <div class="d-flex justify-content-between align-items-start">
                            <div class="flex-grow-1">
                                <h5 class="card-title">
                                    ${announcement.title}
                                    ${getTypeBadge(announcement.type)}
                                </h5>
                                <h6 class="text-muted mb-2">
                                    <i class="fas fa-university"></i> ${announcement.college}
                                </h6>
                                <p class="card-text">${announcement.description}</p>
                                
                                ${announcement.eventDate ? `
                                    <div class="mb-2">
                                        <i class="fas fa-calendar"></i> <strong>Date:</strong> ${new Date(announcement.eventDate).toLocaleDateString()}
                                    </div>
                                ` : ''}
                                
                                <div class="mb-2">
                                    <small class="text-muted">
                                        Posted by: ${announcement.postedBy} | ${new Date(announcement.postedDate).toLocaleDateString()}
                                    </small>
                                </div>
                            </div>
                        </div>
                        
                        <div class="mt-3">
                            ${announcement.registrationRequired === 'yes' ? `
                                <button class="btn btn-primary me-2" onclick="registerForEvent(${announcement.id})">
                                    <i class="fas fa-user-plus"></i> Register
                                </button>
                            ` : ''}
                            
                            ${announcement.contactEmail ? `
                                <a href="mailto:${announcement.contactEmail}" class="btn btn-outline-primary">
                                    <i class="fas fa-envelope"></i> Contact
                                </a>
                            ` : ''}
                        </div>
                    </div>
                </div>
            `).join('');
        }

        function getCardClass(type) {
            switch(type) {
                case 'urgent': return 'urgent-card';
                case 'event': return 'event-card';
                default: return 'announcement-card';
            }
        }

        function getTypeBadge(type) {
            const badges = {
                'urgent': '<span class="badge bg-danger ms-2">Urgent</span>',
                'event': '<span class="badge bg-success ms-2">Event</span>',
                'general': '<span class="badge bg-primary ms-2">General</span>'
            };
            return badges[type] || '';
        }

        function filterAnnouncements() {
            const typeFilter = document.getElementById('filterType').value;
            const collegeFilter = document.getElementById('filterCollege').value;

            let filtered = announcements.filter(announcement => {
                if (typeFilter && announcement.type !== typeFilter) return false;
                if (collegeFilter && announcement.college !== collegeFilter) return false;
                return true;
            });

            displayAnnouncements(filtered);
        }

        function registerForEvent(announcementId) {
            selectedAnnouncementId = announcementId;
            new bootstrap.Modal(document.getElementById('registrationModal')).show();
        }

        document.getElementById('eventRegistrationForm').addEventListener('submit', function(e) {
            e.preventDefault();
            
            const registration = {
                announcementId: selectedAnnouncementId,
                studentName: document.getElementById('studentName').value,
                rollNumber: document.getElementById('rollNumber').value,
                college: document.getElementById('studentCollege').value,
                email: document.getElementById('studentEmail').value,
                phone: document.getElementById('studentPhone').value,
                registeredAt: new Date().toISOString()
            };

            // Save registration
            let registrations = JSON.parse(localStorage.getItem('eventRegistrations') || '[]');
            registrations.push(registration);
            localStorage.setItem('eventRegistrations', JSON.stringify(registrations));

            bootstrap.Modal.getInstance(document.getElementById('registrationModal')).hide();
            this.reset();
            alert('Registration successful! You will receive confirmation email shortly.');
        });
    </script>
</body>
</html>