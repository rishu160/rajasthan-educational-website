<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Offline Learning - Video Downloads | Rajasthan Digital Education</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css">
    <style>
        .video-card {
            transition: transform 0.3s ease;
            border: none;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
        }
        .video-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 8px 25px rgba(0,0,0,0.15);
        }
        .download-btn {
            background: linear-gradient(135deg, #28a745, #20c997);
            border: none;
            transition: all 0.3s ease;
        }
        .download-btn:hover {
            background: linear-gradient(135deg, #218838, #1ea080);
            transform: scale(1.05);
        }
        .progress-bar {
            transition: width 0.3s ease;
        }
        .video-thumbnail {
            height: 200px;
            object-fit: cover;
            background: linear-gradient(135deg, #FF6B35, #F7931E);
        }
    </style>
</head>
<body>

<!-- Header -->
<nav class="navbar navbar-expand-lg navbar-light bg-white shadow-sm">
    <div class="container">
        <a class="navbar-brand" href="index.html">
            <i class="fas fa-graduation-cap text-primary me-2"></i>
            <span class="fw-bold text-primary">Rajasthan Digital Education</span>
        </a>
        <a href="index.html" class="btn btn-outline-primary">
            <i class="fas fa-home me-1"></i>Back to Home
        </a>
    </div>
</nav>

<!-- Main Content -->
<div class="container mt-4">
    <div class="row">
        <div class="col-12">
            <div class="d-flex justify-content-between align-items-center mb-4">
                <div>
                    <h2 class="text-primary mb-1">
                        <i class="fas fa-download me-2"></i>Offline Learning - Video Downloads
                    </h2>
                    <p class="text-muted">Download lectures for offline study. Perfect for areas with limited internet connectivity.</p>
                </div>
                <div class="text-end">
                    <small class="text-success">
                        <i class="fas fa-wifi me-1"></i>Total Downloads: 1,247
                    </small>
                </div>
            </div>
        </div>
    </div>

    <!-- Filter Section -->
    <div class="row mb-4">
        <div class="col-md-6">
            <select class="form-select" id="subjectFilter">
                <option value="">All Subjects</option>
                <option value="computer-science">Computer Science</option>
                <option value="mathematics">Mathematics</option>
                <option value="physics">Physics</option>
                <option value="chemistry">Chemistry</option>
                <option value="english">English</option>
            </select>
        </div>
        <div class="col-md-6">
            <select class="form-select" id="qualityFilter">
                <option value="">All Quality</option>
                <option value="720p">720p HD</option>
                <option value="480p">480p</option>
                <option value="360p">360p (Low Data)</option>
            </select>
        </div>
    </div>

    <!-- Video Grid -->
    <div class="row" id="videoGrid">
        <!-- Computer Science Videos -->
        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card video-card h-100">
                <div class="video-thumbnail d-flex align-items-center justify-content-center text-white">
                    <div class="text-center">
                        <i class="fas fa-code fa-3x mb-2"></i>
                        <h5>Data Structures</h5>
                    </div>
                </div>
                <div class="card-body">
                    <h6 class="card-title">Introduction to Data Structures</h6>
                    <p class="card-text text-muted small">
                        <i class="fas fa-user me-1"></i>Prof. Rajesh Kumar<br>
                        <i class="fas fa-clock me-1"></i>45 minutes<br>
                        <i class="fas fa-download me-1"></i>156 downloads
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-primary">Computer Science</span>
                        <span class="badge bg-success">720p HD</span>
                    </div>
                    <div class="mt-3">
                        <button class="btn download-btn text-white w-100" onclick="downloadVideo('data-structures', this)">
                            <i class="fas fa-download me-2"></i>Download (125 MB)
                        </button>
                        <div class="progress mt-2" style="height: 4px; display: none;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card video-card h-100">
                <div class="video-thumbnail d-flex align-items-center justify-content-center text-white">
                    <div class="text-center">
                        <i class="fas fa-database fa-3x mb-2"></i>
                        <h5>Database Systems</h5>
                    </div>
                </div>
                <div class="card-body">
                    <h6 class="card-title">SQL Fundamentals</h6>
                    <p class="card-text text-muted small">
                        <i class="fas fa-user me-1"></i>Dr. Priya Sharma<br>
                        <i class="fas fa-clock me-1"></i>38 minutes<br>
                        <i class="fas fa-download me-1"></i>203 downloads
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-primary">Computer Science</span>
                        <span class="badge bg-warning">480p</span>
                    </div>
                    <div class="mt-3">
                        <button class="btn download-btn text-white w-100" onclick="downloadVideo('sql-fundamentals', this)">
                            <i class="fas fa-download me-2"></i>Download (89 MB)
                        </button>
                        <div class="progress mt-2" style="height: 4px; display: none;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card video-card h-100">
                <div class="video-thumbnail d-flex align-items-center justify-content-center text-white">
                    <div class="text-center">
                        <i class="fas fa-calculator fa-3x mb-2"></i>
                        <h5>Mathematics</h5>
                    </div>
                </div>
                <div class="card-body">
                    <h6 class="card-title">Calculus - Derivatives</h6>
                    <p class="card-text text-muted small">
                        <i class="fas fa-user me-1"></i>Prof. Amit Singh<br>
                        <i class="fas fa-clock me-1"></i>52 minutes<br>
                        <i class="fas fa-download me-1"></i>178 downloads
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-info">Mathematics</span>
                        <span class="badge bg-success">720p HD</span>
                    </div>
                    <div class="mt-3">
                        <button class="btn download-btn text-white w-100" onclick="downloadVideo('calculus-derivatives', this)">
                            <i class="fas fa-download me-2"></i>Download (142 MB)
                        </button>
                        <div class="progress mt-2" style="height: 4px; display: none;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card video-card h-100">
                <div class="video-thumbnail d-flex align-items-center justify-content-center text-white">
                    <div class="text-center">
                        <i class="fas fa-atom fa-3x mb-2"></i>
                        <h5>Physics</h5>
                    </div>
                </div>
                <div class="card-body">
                    <h6 class="card-title">Quantum Mechanics Basics</h6>
                    <p class="card-text text-muted small">
                        <i class="fas fa-user me-1"></i>Dr. Neha Gupta<br>
                        <i class="fas fa-clock me-1"></i>41 minutes<br>
                        <i class="fas fa-download me-1"></i>134 downloads
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-danger">Physics</span>
                        <span class="badge bg-warning">480p</span>
                    </div>
                    <div class="mt-3">
                        <button class="btn download-btn text-white w-100" onclick="downloadVideo('quantum-mechanics', this)">
                            <i class="fas fa-download me-2"></i>Download (95 MB)
                        </button>
                        <div class="progress mt-2" style="height: 4px; display: none;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card video-card h-100">
                <div class="video-thumbnail d-flex align-items-center justify-content-center text-white">
                    <div class="text-center">
                        <i class="fas fa-flask fa-3x mb-2"></i>
                        <h5>Chemistry</h5>
                    </div>
                </div>
                <div class="card-body">
                    <h6 class="card-title">Organic Chemistry - Reactions</h6>
                    <p class="card-text text-muted small">
                        <i class="fas fa-user me-1"></i>Prof. Suresh Patel<br>
                        <i class="fas fa-clock me-1"></i>47 minutes<br>
                        <i class="fas fa-download me-1"></i>189 downloads
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-warning">Chemistry</span>
                        <span class="badge bg-success">720p HD</span>
                    </div>
                    <div class="mt-3">
                        <button class="btn download-btn text-white w-100" onclick="downloadVideo('organic-chemistry', this)">
                            <i class="fas fa-download me-2"></i>Download (128 MB)
                        </button>
                        <div class="progress mt-2" style="height: 4px; display: none;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-lg-4 col-md-6 mb-4">
            <div class="card video-card h-100">
                <div class="video-thumbnail d-flex align-items-center justify-content-center text-white">
                    <div class="text-center">
                        <i class="fas fa-language fa-3x mb-2"></i>
                        <h5>English</h5>
                    </div>
                </div>
                <div class="card-body">
                    <h6 class="card-title">Grammar & Communication</h6>
                    <p class="card-text text-muted small">
                        <i class="fas fa-user me-1"></i>Ms. Kavita Joshi<br>
                        <i class="fas fa-clock me-1"></i>35 minutes<br>
                        <i class="fas fa-download me-1"></i>267 downloads
                    </p>
                    <div class="d-flex justify-content-between align-items-center">
                        <span class="badge bg-secondary">English</span>
                        <span class="badge bg-info">360p</span>
                    </div>
                    <div class="mt-3">
                        <button class="btn download-btn text-white w-100" onclick="downloadVideo('english-grammar', this)">
                            <i class="fas fa-download me-2"></i>Download (67 MB)
                        </button>
                        <div class="progress mt-2" style="height: 4px; display: none;">
                            <div class="progress-bar bg-success" role="progressbar" style="width: 0%"></div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Advanced Features -->
    <div class="row mt-5">
        <div class="col-md-6 mb-4">
            <div class="card border-primary">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0"><i class="fas fa-wifi-slash me-2"></i>Offline Mode Simulator</h5>
                </div>
                <div class="card-body">
                    <p>Test offline functionality without internet connection</p>
                    <button class="btn btn-outline-primary" onclick="simulateOfflineMode()">
                        <i class="fas fa-power-off me-2"></i>Enable Offline Mode
                    </button>
                    <div id="offlineStatus" class="mt-3" style="display: none;">
                        <div class="alert alert-warning">
                            <i class="fas fa-exclamation-triangle me-2"></i>
                            <strong>Offline Mode Active!</strong> All content now accessible without internet.
                        </div>
                    </div>
                </div>
            </div>
        </div>
        
        <div class="col-md-6 mb-4">
            <div class="card border-success">
                <div class="card-header bg-success text-white">
                    <h5 class="mb-0"><i class="fas fa-mobile-alt me-2"></i>PWA Installation</h5>
                </div>
                <div class="card-body">
                    <p>Install as Progressive Web App for offline access</p>
                    <button class="btn btn-outline-success" onclick="installPWA()">
                        <i class="fas fa-download me-2"></i>Install PWA
                    </button>
                    <div id="pwaStatus" class="mt-3" style="display: none;">
                        <div class="alert alert-success">
                            <i class="fas fa-check-circle me-2"></i>
                            <strong>PWA Installed!</strong> Access from home screen offline.
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Storage Management -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-info">
                <div class="card-header bg-info text-white">
                    <h5 class="mb-0"><i class="fas fa-hdd me-2"></i>Storage Management</h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-8">
                            <h6>Device Storage Usage</h6>
                            <div class="progress mb-2" style="height: 20px;">
                                <div class="progress-bar bg-info" style="width: 65%">2.1 GB Used</div>
                            </div>
                            <small class="text-muted">2.1 GB of 8 GB available storage used</small>
                        </div>
                        <div class="col-md-4 text-end">
                            <button class="btn btn-outline-danger btn-sm" onclick="clearStorage()">
                                <i class="fas fa-trash me-1"></i>Clear Cache
                            </button>
                            <button class="btn btn-outline-info btn-sm mt-2" onclick="optimizeStorage()">
                                <i class="fas fa-compress me-1"></i>Optimize
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Download Queue -->
    <div class="row mb-4">
        <div class="col-12">
            <div class="card border-warning">
                <div class="card-header bg-warning text-dark">
                    <h5 class="mb-0"><i class="fas fa-list me-2"></i>Download Queue Manager</h5>
                </div>
                <div class="card-body">
                    <div class="table-responsive">
                        <table class="table table-sm">
                            <thead>
                                <tr>
                                    <th>Video</th>
                                    <th>Size</th>
                                    <th>Status</th>
                                    <th>Progress</th>
                                    <th>Action</th>
                                </tr>
                            </thead>
                            <tbody id="downloadQueue">
                                <tr>
                                    <td>Advanced Algorithms</td>
                                    <td>156 MB</td>
                                    <td><span class="badge bg-warning">Queued</span></td>
                                    <td><div class="progress" style="height: 15px;"><div class="progress-bar" style="width: 0%"></div></div></td>
                                    <td><button class="btn btn-sm btn-primary" onclick="startQueueDownload(this)">Start</button></td>
                                </tr>
                                <tr>
                                    <td>Machine Learning Basics</td>
                                    <td>203 MB</td>
                                    <td><span class="badge bg-warning">Queued</span></td>
                                    <td><div class="progress" style="height: 15px;"><div class="progress-bar" style="width: 0%"></div></div></td>
                                    <td><button class="btn btn-sm btn-primary" onclick="startQueueDownload(this)">Start</button></td>
                                </tr>
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Download Stats -->
    <div class="row mt-5">
        <div class="col-12">
            <div class="card bg-light">
                <div class="card-body">
                    <h5 class="card-title">
                        <i class="fas fa-chart-bar me-2"></i>Real-time Analytics Dashboard
                    </h5>
                    <div class="row text-center">
                        <div class="col-md-3">
                            <h4 class="text-primary" id="totalDownloads">1,247</h4>
                            <small class="text-muted">Total Downloads</small>
                        </div>
                        <div class="col-md-3">
                            <h4 class="text-success" id="activeStudents">156</h4>
                            <small class="text-muted">Active Students</small>
                        </div>
                        <div class="col-md-3">
                            <h4 class="text-info" id="availableCourses">24</h4>
                            <small class="text-muted">Available Courses</small>
                        </div>
                        <div class="col-md-3">
                            <h4 class="text-warning" id="totalContent">4.8 GB</h4>
                            <small class="text-muted">Total Content</small>
                        </div>
                    </div>
                    <div class="row mt-4">
                        <div class="col-md-6">
                            <canvas id="downloadChart" width="400" height="200"></canvas>
                        </div>
                        <div class="col-md-6">
                            <h6>Recent Activity</h6>
                            <div class="list-group list-group-flush" id="recentActivity">
                                <div class="list-group-item d-flex justify-content-between">
                                    <span><i class="fas fa-download text-success me-2"></i>Data Structures downloaded</span>
                                    <small>2 min ago</small>
                                </div>
                                <div class="list-group-item d-flex justify-content-between">
                                    <span><i class="fas fa-play text-primary me-2"></i>SQL Fundamentals played</span>
                                    <small>5 min ago</small>
                                </div>
                                <div class="list-group-item d-flex justify-content-between">
                                    <span><i class="fas fa-user text-info me-2"></i>New student registered</span>
                                    <small>8 min ago</small>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script>
function downloadVideo(videoId, button) {
    const progressContainer = button.parentElement.querySelector('.progress');
    const progressBar = progressContainer.querySelector('.progress-bar');
    
    // Show progress bar
    progressContainer.style.display = 'block';
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>Downloading...';
    
    // Simulate download progress
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            button.innerHTML = '<i class="fas fa-check me-2"></i>Downloaded';
            button.classList.remove('download-btn');
            button.classList.add('btn-success');
            
            // Show success message
            setTimeout(() => {
                alert('Video downloaded successfully! You can now access it offline.');
                button.innerHTML = '<i class="fas fa-play me-2"></i>Play Offline';
                button.onclick = () => playOfflineVideo(videoId, button);
            }, 500);
        }
    }, 200);
}

// Filter functionality
document.getElementById('subjectFilter').addEventListener('change', filterVideos);
document.getElementById('qualityFilter').addEventListener('change', filterVideos);

function playOfflineVideo(videoId, button) {
    // Create video player modal
    const modal = document.createElement('div');
    modal.className = 'modal fade';
    modal.id = 'videoPlayerModal';
    modal.innerHTML = `
        <div class="modal-dialog modal-xl">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">
                        <i class="fas fa-play-circle me-2"></i>Offline Video Player
                    </h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body p-0">
                    <div class="video-player-container" style="background: #000; position: relative; height: 500px;">
                        <div class="d-flex align-items-center justify-content-center h-100 text-white">
                            <div class="text-center">
                                <i class="fas fa-play-circle fa-5x mb-3 text-primary"></i>
                                <h4>Playing: ${getVideoTitle(videoId)}</h4>
                                <p class="text-muted">Offline Video - No Internet Required</p>
                                <div class="video-controls mt-4">
                                    <button class="btn btn-primary me-2" onclick="controlVideo('play')">
                                        <i class="fas fa-play"></i> Play
                                    </button>
                                    <button class="btn btn-secondary me-2" onclick="controlVideo('pause')">
                                        <i class="fas fa-pause"></i> Pause
                                    </button>
                                    <button class="btn btn-info me-2" onclick="controlVideo('rewind')">
                                        <i class="fas fa-backward"></i> -10s
                                    </button>
                                    <button class="btn btn-info" onclick="controlVideo('forward')">
                                        <i class="fas fa-forward"></i> +10s
                                    </button>
                                </div>
                                <div class="progress mt-3" style="height: 8px;">
                                    <div class="progress-bar bg-primary" id="videoProgress" style="width: 0%"></div>
                                </div>
                                <div class="d-flex justify-content-between mt-2 small text-muted">
                                    <span id="currentTime">00:00</span>
                                    <span id="totalTime">45:30</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
                <div class="modal-footer">
                    <div class="d-flex justify-content-between w-100">
                        <div>
                            <span class="badge bg-success me-2">
                                <i class="fas fa-wifi-slash me-1"></i>Offline Mode
                            </span>
                            <span class="badge bg-info">
                                <i class="fas fa-download me-1"></i>Downloaded
                            </span>
                        </div>
                        <div>
                            <button class="btn btn-outline-primary me-2" onclick="toggleFullscreen()">
                                <i class="fas fa-expand"></i> Fullscreen
                            </button>
                            <button class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    `;
    
    document.body.appendChild(modal);
    const bootstrapModal = new bootstrap.Modal(modal);
    bootstrapModal.show();
    
    // Remove modal when closed
    modal.addEventListener('hidden.bs.modal', () => {
        modal.remove();
    });
    
    // Start video simulation
    startVideoSimulation();
}

function getVideoTitle(videoId) {
    const titles = {
        'data-structures': 'Introduction to Data Structures',
        'sql-fundamentals': 'SQL Fundamentals',
        'calculus-derivatives': 'Calculus - Derivatives',
        'quantum-mechanics': 'Quantum Mechanics Basics',
        'organic-chemistry': 'Organic Chemistry - Reactions',
        'english-grammar': 'Grammar & Communication'
    };
    return titles[videoId] || 'Educational Video';
}

let videoInterval;
let currentVideoTime = 0;
let isPlaying = false;

function controlVideo(action) {
    const progressBar = document.getElementById('videoProgress');
    const currentTimeEl = document.getElementById('currentTime');
    
    switch(action) {
        case 'play':
            if (!isPlaying) {
                isPlaying = true;
                videoInterval = setInterval(() => {
                    currentVideoTime += 1;
                    const progress = (currentVideoTime / 2730) * 100; // 45:30 = 2730 seconds
                    progressBar.style.width = Math.min(progress, 100) + '%';
                    currentTimeEl.textContent = formatTime(currentVideoTime);
                    
                    if (currentVideoTime >= 2730) {
                        controlVideo('pause');
                        alert('Video completed! üéâ');
                    }
                }, 1000);
            }
            break;
        case 'pause':
            isPlaying = false;
            clearInterval(videoInterval);
            break;
        case 'rewind':
            currentVideoTime = Math.max(0, currentVideoTime - 10);
            const rewindProgress = (currentVideoTime / 2730) * 100;
            progressBar.style.width = rewindProgress + '%';
            currentTimeEl.textContent = formatTime(currentVideoTime);
            break;
        case 'forward':
            currentVideoTime = Math.min(2730, currentVideoTime + 10);
            const forwardProgress = (currentVideoTime / 2730) * 100;
            progressBar.style.width = forwardProgress + '%';
            currentTimeEl.textContent = formatTime(currentVideoTime);
            break;
    }
}

function formatTime(seconds) {
    const mins = Math.floor(seconds / 60);
    const secs = seconds % 60;
    return `${mins.toString().padStart(2, '0')}:${secs.toString().padStart(2, '0')}`;
}

function toggleFullscreen() {
    const container = document.querySelector('.video-player-container');
    if (container.requestFullscreen) {
        container.requestFullscreen();
    }
}

function startVideoSimulation() {
    // Auto-start video after 1 second
    setTimeout(() => {
        controlVideo('play');
    }, 1000);
}

// Advanced Features Functions
function simulateOfflineMode() {
    document.getElementById('offlineStatus').style.display = 'block';
    // Simulate offline functionality
    setTimeout(() => {
        alert('üî• Offline Mode Activated! All downloaded content is now accessible without internet connection. This demonstrates how rural students can access education even in remote areas!');
    }, 1000);
}

let deferredPrompt;

// Listen for the beforeinstallprompt event
window.addEventListener('beforeinstallprompt', (e) => {
    e.preventDefault();
    deferredPrompt = e;
});

function installPWA() {
    if (deferredPrompt) {
        // Show the install prompt
        deferredPrompt.prompt();
        
        deferredPrompt.userChoice.then((choiceResult) => {
            if (choiceResult.outcome === 'accepted') {
                document.getElementById('pwaStatus').style.display = 'block';
                alert('üì± PWA Installed Successfully! Check your home screen - "Rajasthan Digital Education" app is now available!');
            } else {
                alert('PWA installation cancelled. You can install it later from browser menu.');
            }
            deferredPrompt = null;
        });
    } else {
        // Fallback for browsers that don't support PWA or already installed
        document.getElementById('pwaStatus').style.display = 'block';
        
        // Show manual installation instructions
        const instructions = `
üì± To add to home screen:

üîπ Chrome/Edge: Menu ‚Üí "Add to Home screen" or "Install app"
üîπ Safari: Share button ‚Üí "Add to Home Screen"
üîπ Firefox: Menu ‚Üí "Install" or "Add to Home screen"

After installation, look for "Rajasthan Digital Education" icon on your home screen!
        `;
        
        alert(instructions);
        
        // Try to trigger browser's native install prompt
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('/sw.js').then(() => {
                console.log('Service Worker registered for PWA');
            });
        }
    }
}

function clearStorage() {
    if(confirm('Clear all cached content? This will free up storage space.')) {
        alert('üóëÔ∏è Storage cleared! 1.2 GB space freed up.');
        updateStorageDisplay(30);
    }
}

function optimizeStorage() {
    alert('‚ö° Storage optimized! Compressed videos to save 40% space while maintaining quality.');
    updateStorageDisplay(45);
}

function updateStorageDisplay(percentage) {
    const progressBar = document.querySelector('.progress-bar.bg-info');
    progressBar.style.width = percentage + '%';
    progressBar.textContent = (percentage * 0.08).toFixed(1) + ' GB Used';
}

function startQueueDownload(button) {
    const row = button.closest('tr');
    const progressBar = row.querySelector('.progress-bar');
    const statusBadge = row.querySelector('.badge');
    
    button.disabled = true;
    button.innerHTML = '<i class="fas fa-spinner fa-spin"></i>';
    statusBadge.className = 'badge bg-primary';
    statusBadge.textContent = 'Downloading';
    
    let progress = 0;
    const interval = setInterval(() => {
        progress += Math.random() * 15;
        if (progress > 100) progress = 100;
        
        progressBar.style.width = progress + '%';
        
        if (progress >= 100) {
            clearInterval(interval);
            statusBadge.className = 'badge bg-success';
            statusBadge.textContent = 'Downloaded';
            button.innerHTML = '<i class="fas fa-play"></i>';
            button.onclick = () => alert('üé• Playing offline video!');
            
            // Update stats
            updateStats();
        }
    }, 200);
}

function updateStats() {
    const downloads = document.getElementById('totalDownloads');
    const students = document.getElementById('activeStudents');
    const courses = document.getElementById('availableCourses');
    
    downloads.textContent = parseInt(downloads.textContent.replace(',', '')) + 1;
    students.textContent = parseInt(students.textContent) + Math.floor(Math.random() * 3);
    
    // Add to recent activity
    addRecentActivity('Video downloaded successfully', 'now');
}

function addRecentActivity(activity, time) {
    const activityList = document.getElementById('recentActivity');
    const newActivity = document.createElement('div');
    newActivity.className = 'list-group-item d-flex justify-content-between';
    newActivity.innerHTML = `
        <span><i class="fas fa-download text-success me-2"></i>${activity}</span>
        <small>${time}</small>
    `;
    activityList.insertBefore(newActivity, activityList.firstChild);
    
    // Keep only last 3 activities
    if (activityList.children.length > 3) {
        activityList.removeChild(activityList.lastChild);
    }
}

// Real-time updates simulation
setInterval(() => {
    const activities = [
        'Student accessed offline content',
        'New video downloaded',
        'Quiz completed offline',
        'Student registered for course',
        'Offline session started'
    ];
    
    const randomActivity = activities[Math.floor(Math.random() * activities.length)];
    const timeAgo = Math.floor(Math.random() * 30) + 1;
    addRecentActivity(randomActivity, timeAgo + ' min ago');
}, 10000);

function filterVideos() {
    const subjectFilter = document.getElementById('subjectFilter').value;
    const qualityFilter = document.getElementById('qualityFilter').value;
    const cards = document.querySelectorAll('.video-card');
    
    cards.forEach(card => {
        const subject = card.querySelector('.badge').textContent.toLowerCase().replace(' ', '-');
        const quality = card.querySelectorAll('.badge')[1].textContent.toLowerCase();
        
        let showCard = true;
        
        if (subjectFilter && !subject.includes(subjectFilter)) {
            showCard = false;
        }
        
        if (qualityFilter && !quality.includes(qualityFilter)) {
            showCard = false;
        }
        
        card.parentElement.style.display = showCard ? 'block' : 'none';
    });
}
</script>

</body>
</html>